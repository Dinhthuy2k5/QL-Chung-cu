/* --- 1. BIẾN MÀU CHUẨN (Đồng bộ toàn app) --- */
$accent-color: #4361ee;       // Xanh dương (Chủ đạo)
$success-color: #00f2c3;      // Xanh lá (Thu phí/Thành công)
$warning-color: #ff8d72;      // Cam (Cảnh báo)
$danger-color: #fd5d93;       // Hồng/Đỏ (Nợ/Xóa)
$info-color: #0ea5e9;         // Xanh lơ (Xem danh sách)
$text-primary: #ffffff;
$text-secondary: #d1d1d1;
$bg-dark-input: #1e1e2f;

// Cấu hình nền kính
$glass-bg: rgba(39, 41, 61, 0.75); 
$glass-border: 1px solid rgba(255, 255, 255, 0.1);
$glass-blur: 12px;
$glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);

@mixin glass-panel {
    background: $glass-bg;
    backdrop-filter: blur($glass-blur);
    -webkit-backdrop-filter: blur($glass-blur);
    border: $glass-border;
    box-shadow: $glass-shadow;
    border-radius: 16px; // Bo góc 16px cho mềm mại
}

.mandatory-dashboard {
    display: flex;
    flex-direction: column;
    gap: 25px;
    color: $text-primary;
    padding-bottom: 30px;
    animation: fadeIn 0.5s ease-out;

    /* --- 1. QUICK ACTIONS (Thanh nút bấm trên cùng) --- */
    .quick-actions-panel {
        @include glass-panel;
        padding: 25px;
        
        h3 { 
            margin: 0 0 20px 0; 
            font-size: 0.95rem; 
            color: $text-secondary; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            font-weight: 600;
            text-align: center; // Căn giữa tiêu đề "Thao tác nghiệp vụ"
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr); // 3 nút đều nhau
            gap: 20px;

            .btn-action {
                padding: 18px;
                border: none;
                border-radius: 12px;
                font-weight: 700;
                font-size: 1rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 12px;
                transition: transform 0.2s, box-shadow 0.2s;
                color: white;
                box-shadow: 0 4px 10px rgba(0,0,0,0.2);

                .icon { font-size: 1.2rem; }

                // Màu sắc riêng cho từng nút (Giống ảnh)
                &.create { 
                    background: $accent-color; // Xanh dương
                    &:hover { background: lighten($accent-color, 5%); box-shadow: 0 6px 15px rgba($accent-color, 0.4); }
                }
                
                &.collect { 
                    background: #28a745; // Xanh lá đậm hơn chút cho nút Thu phí
                    &:hover { background: lighten(#28a745, 5%); box-shadow: 0 6px 15px rgba(#28a745, 0.4); }
                }
                
                &.list { 
                    background: $info-color; // Xanh lơ (Teal/Cyan)
                    &:hover { background: lighten($info-color, 5%); box-shadow: 0 6px 15px rgba($info-color, 0.4); }
                }

                &:active { transform: scale(0.98); }
                &:hover { transform: translateY(-3px); }
            }
        }
    }

    /* --- 2. KPI CARDS (Hàng chỉ số ở giữa) --- */
    .kpi-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 25px;

        .kpi-card {
            @include glass-panel;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;

            h4 { 
                margin: 0 0 15px 0; 
                font-size: 0.85rem; 
                color: $text-secondary; 
                text-transform: uppercase; 
                letter-spacing: 0.5px;
            }
            
            .value { 
                font-size: 2rem; 
                font-weight: 800; 
                margin-bottom: 5px;
                text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            }
            
            .sub-text { 
                font-size: 0.8rem; 
                opacity: 0.7; 
                font-style: italic;
            }

            // Border màu bên trái
            &.blue { 
                border-left: 4px solid $accent-color; 
                .value { color: $accent-color; } 
            }
            &.green { 
                border-left: 4px solid $success-color; 
                .value { color: $success-color; } 
            }
            &.red { 
                border-left: 4px solid $danger-color; 
                .value { color: $danger-color; } 
            }
        }
    }

    /* --- 3. CHARTS GRID (Hàng dưới cùng) --- */
    .charts-grid {
        display: grid;
        // Chia tỉ lệ: Biểu đồ dòng (2 phần) - Biểu đồ tròn (1 phần) - Danh sách nợ (1 phần)
        grid-template-columns: 2fr 1fr 1.2fr; 
        gap: 25px;
        min-height: 400px;

        .chart-panel, .debt-list-panel {
            @include glass-panel;
            padding: 20px;
            display: flex;
            flex-direction: column;

            h4 { 
                margin: 0 0 20px 0; 
                font-size: 1rem; 
                font-weight: 700; 
                color: $text-primary;
                text-align: center;
            }
        }

        .chart-wrapper {
            flex-grow: 1;
            position: relative;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            
            // Placeholder text khi chưa có biểu đồ
            color: $text-secondary;
            font-style: italic;
        }

        /* --- Style riêng cho Danh sách nợ --- */
        .debt-list-panel {
            h4 { 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                gap: 8px;
                color: $warning-color; // Màu cam cảnh báo
            }

            ul {
                list-style: none;
                padding: 0;
                margin: 0;
                overflow-y: auto;
                flex-grow: 1;
                
                // Scrollbar
                &::-webkit-scrollbar { width: 5px; }
                &::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }

                li {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px 10px;
                    border-bottom: 1px solid rgba(255,255,255,0.05);
                    transition: background 0.2s;

                    &:hover { background: rgba(255,255,255,0.05); }
                    &:last-child { border-bottom: none; }

                    .room-info {
                        display: flex;
                        flex-direction: column;
                        .room { 
                            font-weight: 700; 
                            font-size: 1.1rem; 
                            color: $text-primary; 
                        }
                        .month-badge { 
                            font-size: 0.75rem; 
                            color: $warning-color; 
                            margin-top: 3px;
                        }
                    }
                    .amount {
                        color: $danger-color; // Màu đỏ cho số tiền nợ
                        font-weight: 700;
                        font-size: 1.1rem;
                    }
                }
            }
        }
    }
}

// Animation
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* --- RESPONSIVE --- */
@media (max-width: 1200px) {
    .charts-grid {
        grid-template-columns: 1fr 1fr; // Chuyển thành 2 cột
        .chart-panel:first-child { grid-column: span 2; } // Biểu đồ dòng chiếm hết chiều ngang
    }
}

@media (max-width: 768px) {
    .quick-actions-panel .action-buttons { grid-template-columns: 1fr; }
    .kpi-grid { grid-template-columns: 1fr; }
    .charts-grid { grid-template-columns: 1fr; .chart-panel:first-child { grid-column: span 1; } }
}